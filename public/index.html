<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë²ˆí˜¸í‘œ í˜¸ì¶œ ëª¨ë‹ˆí„°</title>
  <style>
    html, body {margin:0;padding:0;overflow:hidden;background:black;height:100%;width:100%;}
    video {position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0;}
    #popup {
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.5);
      display:none;justify-content:center;align-items:center;
      z-index:1;color:white;text-align:center;
    }
    #popup h1 {font-size:400px;animation:blink 2s infinite;margin:0;}
    @keyframes blink {0%,50%,100%{opacity:1;}25%,75%{opacity:0.2;}}
  </style>
</head>
<body>
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4" type="video/mp4" />
  </video>

  <div id="popup"><h1 id="numText"></h1></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const popup = document.getElementById("popup");
    const numText = document.getElementById("numText");
    const bgVideo = document.getElementById("bgVideo");
    const socket = io();

    const params = new URLSearchParams(window.location.search);
    const channel = (params.get("ch") || "A000").toUpperCase();
    socket.emit("joinRoom", channel);

    let currentAudio = null;

    function playSound(number) {
      try {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        currentAudio = new Audio(`sounds/${number}.mp3`);
        currentAudio.play().catch(() => {});
      } catch (e) {}
    }

    // ðŸ”¥ ì—¬ê¸°ë§Œ ìˆ˜ì •ë¨
    function showPopup(number) {
      numText.textContent = number;
      popup.style.display = "flex";

      playSound(number);

      setTimeout(() => {
        popup.style.display = "none";

        // ðŸ”¥ ì‚¼ì„± ì¸í„°ë„· ì „ìš©: íŒì—… ë‹«íž ë•Œ ì˜ìƒ ìž¬ìƒ ë‹¤ì‹œ ì‹¤í–‰
        bgVideo.play().catch(() => {});

      }, 7000);
    }

    socket.on("call", data => showPopup(data.number));
    socket.on("recall", data => showPopup(data.number));
    socket.on("reset", () => popup.style.display = "none");

    // ì˜¤ë””ì˜¤ ê¶Œí•œ í™•ë³´
    document.body.addEventListener("click", () => {
      try {
        const a = new Audio("sounds/silent.mp3");
        a.play().catch(()=>{});
      } catch (e) {}
    }, { once: true });
  </script>
</body>
</html>
