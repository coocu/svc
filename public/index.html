<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë²ˆí˜¸í‘œ í˜¸ì¶œ ëª¨ë‹ˆí„°</title>
  <style>
    html, body {margin:0;padding:0;overflow:hidden;background:black;height:100%;width:100%;}
    video {position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0;}
    #popup {position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;
      z-index:1;color:white;text-align:center;}
    #popup h1 {font-size:400px;animation:blink 2s infinite;margin:0;}
    @keyframes blink {0%,50%,100%{opacity:1;}25%,75%{opacity:0.2;}}
  </style>
</head>
<body>
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4" type="video/mp4" />
  </video>

  <div id="popup"><h1 id="numText"></h1></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const popup = document.getElementById("popup");
    const numText = document.getElementById("numText");
    const bgVideo = document.getElementById("bgVideo");
    const socket = io();

    // -------------------------------------------
    //  ðŸ”¥ ì‚¼ì„±ì¸í„°ë„· ìž¬ìƒ ì°¨ë‹¨ í•´ê²°ìš© ì½”ë“œ
    // -------------------------------------------
    function forcePlay() {
      bgVideo.muted = true;
      bgVideo.play().catch(() => {});
    }

    // ì²« í™”ë©´í„°ì¹˜ â†’ ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ê¶Œí•œ í•´ì œ
    document.body.addEventListener("click", () => {
      forcePlay();
    }, { once:true });

    // ì˜ìƒì´ ë©ˆì¶”ë©´ ìžë™ ìž¬ì‹œë„(ì‚¼ì„±ë¸Œë¼ìš°ì € ì „ìš© í•´ê²°)
    setInterval(() => {
      if (bgVideo.paused) {
        forcePlay();
      }
    }, 1500);
    // -------------------------------------------


    // URLì—ì„œ ì±„ë„ì½”ë“œ ì½ê¸°
    const params = new URLSearchParams(window.location.search);
    const channel = (params.get("ch") || "A000").toUpperCase();
    socket.emit("joinRoom", channel);

    // ì‚¬ìš´ë“œ
    function playSound(number) {
      const audio = new Audio(`sounds/${number}.mp3`);
      audio.play().catch(()=>{});
    }

    // íŒì—…
    function showPopup(number) {
      numText.textContent = number;
      popup.style.display = "flex";
      playSound(number);
      setTimeout(() => popup.style.display = "none", 7000);
    }

    socket.on("call", data => showPopup(data.number));
    socket.on("recall", data => showPopup(data.number));
    socket.on("reset", () => popup.style.display = "none");
  </script>
</body>
</html>
